<header class="floating">
  <button id="menu-btn" class="open-nav" aria-expanded="false" style="padding-bottom:4px;">â˜°</button>
</header>

<style>
header.floating {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  margin: 1rem;
  z-index: 4;
}

header.floating button.open-nav {
  color: #fff;
  font-size: 2rem;
  padding: 0.1rem 0.8rem;
  transition: background 1.25s ease, color 1.25s ease, box-shadow 1.25s ease;
  -webkit-tap-highlight-color: transparent;
  border-radius: 0.5rem;
  outline: 1px solid #000;
  border: 1px solid #7f7f7f;
  box-shadow: 0 0 1px 0px #000;
  background: linear-gradient(to bottom, rgb(69 72 77 / 85%) 0%, rgb(0 0 0 / 89%) 100%);
}

header.floating button.open-nav:active,
header.floating button.open-nav.tap {
  background: #fff;
  color: #000;
  box-shadow: 0 0 10px 2px #fff;
}
</style>

<script>
(() => {
  const btn = document.getElementById('menu-btn');
  const nav = document.getElementById('site-nav');
  if (!btn || !nav) return;

  let scrollY = 0;
  let closing = false;

  function lockScroll() {
    scrollY = window.scrollY || document.documentElement.scrollTop || 0;
    document.documentElement.classList.add('nav-open');
    document.body.classList.add('scroll-lock');
    document.body.style.top = `-${scrollY}px`;
  }

  function unlockScroll() {
    document.documentElement.classList.remove('nav-open');
    document.body.classList.remove('scroll-lock');
    const y = Math.abs(parseInt(document.body.style.top || '0', 10)) || 0;
    document.body.style.top = '';
    window.scrollTo(0, y);
  }

  function openNav() {
    if (nav.classList.contains('open')) return;
    nav.classList.add('open');
    btn.setAttribute('aria-expanded', 'true');
    lockScroll();
  }

  function closeNav() {
    if (!nav.classList.contains('open') || closing) return;
    closing = true;
    nav.classList.remove('open');
    btn.setAttribute('aria-expanded', 'false');

    // wait for the slide-out to finish before unlocking scroll
    const onEnd = (e) => {
      if (e.propertyName !== 'transform') return;
      nav.removeEventListener('transitionend', onEnd);
      closing = false;
      unlockScroll();
    };
    nav.addEventListener('transitionend', onEnd);
  }

  btn.addEventListener('click', () => {
    btn.classList.add('tap');
    setTimeout(() => btn.classList.remove('tap'), 150);
    nav.classList.contains('open') ? closeNav() : openNav();
  });

  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && nav.classList.contains('open')) closeNav();
  });

  nav.addEventListener('click', (e) => {
    const a = e.target.closest('a');
    if (a) closeNav();
  });
})();
</script>
